---
title: |
  <center>![](San Diego.png){width=7in} </center>
  <center>**Airbnb San Diego Market Analysis Report**</center>
author: "BUDT 758T Data Mining and Predictive Analysis Team 1"
date: "May 7th, 2020" 
output:
  html_document:
    toc: true
    df_print: paged
  html_notebook: default
  pdf_document:
    toc: true
    latex_engine: xelatex
always_allow_html: yes
---

**“We, the undersigned, certify that the report submitted is our own original work: all authors participated in the work in a substantive way; all authors have seen and approved the report as submitted; the text, images illustrations, and other items included the manuscript do not carry infringement/plagiarism issue upon any existing copyright materials.”**

&nbsp;

|Team Member|Names of the Signed team members|
|-:|:-|:-:|-|
|Contact Member|Qiyuan Peng|
|Team member 2|Di Hu|
|Team member 3|Xin Xu|
|Team member 4|Qinyu Wei|
|Team member 5|Munish Khurana|

&nbsp;

&nbsp;

# **Introduction**

#### San Diego was the second most popular California destination for Airbnb users last year, bringing hosts $213 million in income. Most of the customers of Airbnb are coming for vacation in San Diego. Roughly 482,400 people stayed in an Airbnb somewhere in the county between Memorial Day and Labor day, according to the  2019 Airbnb’s data. The rentals generated about $112 million in supplemental income countywide and $75 million in the city of San Diego.  

# **Executive Summary**

#### Our perspective is focusing on the initial acquisition and features set up for investors. Investors want to know how to get an Airbnb with a high booking rate to maximize the return on Investment. Thus, our study is focusing on the location and features of a new house. We conducted a series of data analysis, research, and business analytics for the Airbnb Market at San Diego. After features site selection and feature analysis, the final location will be the Ocean Beach area because it has the sea view, beaches, and more restaurants and bars nearby. The optimal house type is a cottage with one bedroom and one bathroom with two beds. 
#### We want to find a site that has a sea view, near the beach, restaurants, downtown, and bars. Customers are willing to book an Airbnb with Internet access, wifi, laptop, AC, no smoking, kitchen (with washing machine, microwave, coffee, tableware, oven, stove and grill), some essentials such as shampoo, hair dryer, hand sanitizer and bathtub. Since most people in the US have dogs, they want to book an Airbnb which is pet friendly. The room should be safe and private. Therefore, an intelligent lock that could be used in self-Check in is necessary. People don’t want to book an Airbnb with a strict cancellation policy. They want the Host to have an email, phone, google, and facebook verification to make sure the host is certified.  

# **Research Questions & Expected Findings**

### Preliminary questions related to our perspective:

### Where is the best place to own an Airbnb house in San Diego?

#### 1.Where is the best location?
#### 2.Which location has relatively high demand? Are those locations near hot tourist sites(attractions)?
#### 3.Which neighborhood is crowded with Airbnb hosts in certain location? 
#### 4.Which neighborhoods has high proportion of high booking rate?
#### We found that most of the customers of Airbnb are coming for vacation. Therefore, we expected that People are more likely to live near San Diego’s most popular tourist attractions such as the Spanish Colonial-style architecture found in Balboa Park; the world famous San Diego Zoo; the Ocean Beach; the SeaWorld San Diego and the Midway Aircraft Carrier Museum.  

### What kind of homes?

#### 1.Which property type is more likely to have a high booking rate?
#### 2.Which room type is more likely to have a high booking rate?
#### 3.How many beds&bathrooms should we include in our house to make it more popular?
#### From marketing researched we had done at the beginning of our project, we find that people who visit San Diego always expect to have a chill vacation with sunshine and beaches. Therefore, we assumed that most of visitors are couples or families, who may prefer private space in order to hava a peaceful vacation, so we expected to find that a small entire house having 1-3 bedrooms may be more popular.  

### What features may help to become more popular?

#### 1.What kind of amenities can attract more customers to book?
#### 2.What kind of keywords should a host include in the description to attract more customers?
#### San Diego is famous by its Latin American culture, sea coasts, seafoods and beaches. Therefore, we tought that the house which have easily access to these key features like sea view, restaurants, and beaches will attract more visitor to rent.  

```{r setup, include=FALSE}
#setwd("~/downloads") #Don't forget to set your working directory before you start!
library("tidyverse")
library("tidymodels")
library("plotly")
library("skimr")
library("caret")
library("car")
library("tidytext")
library(ROCit)
library(MLmetrics)
library(lubridate)

knitr::opts_chunk$set(echo = TRUE,warning=FALSE)
```

# **Methodology**
## Data Preparation
### Splited the dataset into training set and testing set
We need to use some aggregation functions to process the null values so we need to first split the dataset to avoid the training data influencing the test data.
The processing code for training set and test set are almost the same, so we only present the coding for training set and set include=False for test set chunks.
```{r}
df<-
  read_csv("airbnbSanDiego.csv")

skim(df)

set.seed(123)
dfTrain <- df%>% sample_frac(.75) 
dfTest <- dplyr::setdiff(df, dfTrain)
```
### Remove dollar sign and change price related character to numeric
```{r}
dfTrain$cleaning_fee<-gsub("\\$","",dfTrain$cleaning_fee)#remove dollar sign
dfTrain$monthly_price<-gsub("\\$","",dfTrain$monthly_price)
dfTrain$price<-gsub("\\$","",dfTrain$price)
dfTrain$security_deposit<-gsub("\\$","",dfTrain$security_deposit)
dfTrain$weekly_price<-gsub("\\$","",dfTrain$weekly_price)
dfTrain$extra_people<-gsub("\\$","",dfTrain$extra_people)

dfTrain$cleaning_fee <- as.numeric(dfTrain$cleaning_fee)
dfTrain$monthly_price <- as.numeric(dfTrain$monthly_price)
dfTrain$price <- as.numeric(dfTrain$price)
dfTrain$security_deposit <- as.numeric(dfTrain$security_deposit)
dfTrain$weekly_price <- as.numeric(dfTrain$weekly_price)
dfTrain$extra_people <- as.numeric(dfTrain$extra_people)
```
### Transfer response rate from percentage to decimel
```{r}
dfTrain$host_response_rate <- as.numeric(sub("%", "",dfTrain$host_response_rate,fixed=TRUE))/100
```

```{r include=FALSE}
# for test set
dfTest$cleaning_fee<-gsub("\\$","",dfTest$cleaning_fee)#remove dollar sign
dfTest$monthly_price<-gsub("\\$","",dfTest$monthly_price)
dfTest$price<-gsub("\\$","",dfTest$price)
dfTest$security_deposit<-gsub("\\$","",dfTest$security_deposit)
dfTest$weekly_price<-gsub("\\$","",dfTest$weekly_price)
dfTest$extra_people<-gsub("\\$","",dfTest$extra_people)

dfTest$cleaning_fee <- as.numeric(dfTest$cleaning_fee)
dfTest$monthly_price <- as.numeric(dfTest$monthly_price)
dfTest$price <- as.numeric(dfTest$price)
dfTest$security_deposit <- as.numeric(dfTest$security_deposit)
dfTest$weekly_price <- as.numeric(dfTest$weekly_price)
dfTest$extra_people <- as.numeric(dfTest$extra_people)

dfTest$host_response_rate <- as.numeric(sub("%", "",dfTest$host_response_rate,fixed=TRUE))/100
```

### Data cleaning for original variables
#### Filling null for original numeric variables
```{r}
df%>% 
  filter(is.na(review_scores_accuracy))%>%
  group_by(high_booking_rate)%>%
  tally()
df%>%
  filter(is.na(review_scores_cleanliness))%>%
  group_by(high_booking_rate)%>%
  tally()
df%>%
  filter(is.na(review_scores_checkin))%>%
  group_by(high_booking_rate)%>%
  tally()
df%>%
  filter(is.na(review_scores_communication))%>%
  group_by(high_booking_rate)%>%
  tally()
df%>%
  filter(is.na(review_scores_location))%>%
  group_by(high_booking_rate)%>%
  tally()
df%>%
  filter(is.na(review_scores_value))%>%
  group_by(high_booking_rate)%>%
  tally()
df%>%
  filter(is.na(review_scores_rating))%>%
  group_by(high_booking_rate)%>%
  tally()

dfTrain%>%
  filter(price==0)
```

In general, we filled null values using the mean or median except 3 special situations below:  
1. After data exploration, we found that if any reviw_scores is null, the porprotion of high booking rate is 0% in our dataset. However, the mean of those review scores columns are too high (above 9), so we will use 0 to fill in the review_scores instead of using mean or median.  
2. In addition, we found some 0 in price column, which may be some mistakes, so we take those 0 price as null values and fill them with mean.  
3. Weekly price and Monthly price have a lot of null values, but we want to keep those non-null values. So, we looked into the Airbnb website. We found that many hosts did not list out they weekly price and monthly price directly, it may indicate that the weekly price is just simply times the price per nigh by days. Other hosts who listed they weekly and monthly price are using them to indicate the discont for long-term renting. Therefore, we will use price to calculate null weekly and monthly prices.  
```{r}
dfTrain$host_response_rate[is.na(dfTrain$host_response_rate)] <- median(dfTrain$host_response_rate, na.rm=TRUE)

dfTrain$host_listings_count[is.na(dfTrain$host_listings_count)] <- 0

dfTrain$review_scores_value[is.na(dfTrain$review_scores_value)] <- 0

dfTrain$review_scores_rating[is.na(dfTrain$review_scores_rating)] <-0

dfTrain$review_scores_location[is.na(dfTrain$review_scores_location)] <-0

dfTrain$review_scores_communication[is.na(dfTrain$review_scores_communication)] <- 0

dfTrain$review_scores_cleanliness[is.na(dfTrain$review_scores_cleanliness)] <- 0

dfTrain$review_scores_checkin[is.na(dfTrain$review_scores_checkin)] <- 0

dfTrain$review_scores_accuracy[is.na(dfTrain$review_scores_accuracy)] <- 0

dfTrain$beds[is.na(dfTrain$beds)] <- median(dfTrain$beds, na.rm=TRUE)

dfTrain$bedrooms[is.na(dfTrain$bedrooms)] <- median(dfTrain$bedrooms, na.rm=TRUE)

dfTrain$bathrooms[is.na(dfTrain$bathrooms)] <- median(dfTrain$bathrooms, na.rm=TRUE)

dfTrain$extra_people[is.na(dfTrain$extra_people)] <- mean(dfTrain$extra_people, na.rm=TRUE)

dfTrain$security_deposit[is.na(dfTrain$security_deposit)] <- mean(dfTrain$security_deposit, na.rm=TRUE)

dfTrain$cleaning_fee[is.na(dfTrain$cleaning_fee)] <- mean(dfTrain$cleaning_fee, na.rm=TRUE)

dfTrain$price[is.na(dfTrain$price)] <- mean(dfTrain$price, na.rm=TRUE)

dfTrain$price[dfTrain$price==0] <- mean(dfTrain$price, na.rm=TRUE)

dfTrain$weekly_price<-ifelse(is.na(dfTrain$weekly_price),dfTrain$price*7,dfTrain$weekly_price)

dfTrain$monthly_price<-ifelse(is.na(dfTrain$monthly_price),dfTrain$price*30,dfTrain$monthly_price)
```

```{r include=FALSE}
# for test set
dfTest$host_response_rate[is.na(dfTest$host_response_rate)] <- median(dfTest$host_response_rate, na.rm=TRUE)

dfTest$host_listings_count[is.na(dfTest$host_listings_count)] <- mean(dfTest$host_listings_count, na.rm=TRUE)

dfTest$review_scores_value[is.na(dfTest$review_scores_value)] <- 0

dfTest$review_scores_rating[is.na(dfTest$review_scores_rating)] <- 0

dfTest$review_scores_location[is.na(dfTest$review_scores_location)] <- 0

dfTest$review_scores_communication[is.na(dfTest$review_scores_communication)] <- 0

dfTest$review_scores_cleanliness[is.na(dfTest$review_scores_cleanliness)] <- 0

dfTest$review_scores_checkin[is.na(dfTest$review_scores_checkin)] <- 0

dfTest$review_scores_accuracy[is.na(dfTest$review_scores_accuracy)] <- 0

dfTest$beds[is.na(dfTest$beds)] <- median(dfTest$beds, na.rm=TRUE)

dfTest$bedrooms[is.na(dfTest$bedrooms)] <- median(dfTest$bedrooms, na.rm=TRUE)

dfTest$bathrooms[is.na(dfTest$bathrooms)] <- median(dfTest$bathrooms, na.rm=TRUE)

dfTest$extra_people[is.na(dfTest$extra_people)] <- mean(dfTest$extra_people, na.rm=TRUE)

dfTest$security_deposit[is.na(dfTest$security_deposit)] <- mean(dfTest$security_deposit, na.rm=TRUE)

dfTest$cleaning_fee[is.na(dfTest$cleaning_fee)] <- mean(dfTest$cleaning_fee, na.rm=TRUE)

dfTest$price[is.na(dfTest$price)] <- mean(dfTest$price, na.rm=TRUE)

dfTest$price[dfTest$price==0] <- mean(dfTest$price, na.rm=TRUE)

dfTest$weekly_price<-ifelse(is.na(dfTest$weekly_price),dfTest$price*7,dfTest$weekly_price)

dfTest$monthly_price<-ifelse(is.na(dfTest$monthly_price),dfTest$price*30,dfTest$monthly_price)
```

#### Managing missing values for original character variables
1. Keep only year for host_since, and use "Unknown" to fill the null values
2. Replace null values with "Other" in host_response _time
3. Replace null values wuth "FALSE" for host_has_profile_pic, host_identity_verified, host_is_superhost
4. Change bedtype to real bed and non-real bed into dummy varaible
```{r}
dfTrain$host_since <- year(dfTrain$host_since)
dfTrain$host_since[is.na(dfTrain$host_since)] <-"Unknown"
```

```{r include=FALSE}
#for test
dfTest$host_since <- year(dfTest$host_since)
dfTest$host_since[is.na(dfTest$host_since)] <-"Unknown"
```

```{r}
dfTrain$host_response_time[is.na(dfTrain$host_response_time)] <- "Other"
dfTrain$host_response_time[dfTrain$host_response_time == 'N/A'] <- 'Other'
```

```{r include=FALSE}
#for test
dfTest$host_response_time[is.na(dfTest$host_response_time)] <- "Other"
dfTest$host_response_time[dfTest$host_response_time == 'N/A'] <- 'Other'
```

```{r}
dfTrain %>%
  group_by(host_has_profile_pic ) %>%
  tally()
dfTrain %>%
  group_by(host_identity_verified ) %>%
  tally()
dfTrain %>%
  group_by(host_is_superhost ) %>%
  tally() 
dfTrain$host_has_profile_pic[is.na(dfTrain$host_has_profile_pic)] <- FALSE
dfTrain$host_identity_verified[is.na(dfTrain$host_identity_verified)] <- FALSE
dfTrain$host_is_superhost[is.na(dfTrain$host_is_superhost)] <- FALSE
```

```{r include=FALSE}
#for test
dfTest %>%
  group_by(host_has_profile_pic ) %>%
  tally()
dfTest %>%
  group_by(host_identity_verified ) %>%
  tally()
dfTest %>%
  group_by(host_is_superhost ) %>%
  tally() 
#replace NA to FALSE
dfTest$host_has_profile_pic[is.na(dfTest$host_has_profile_pic)] <- FALSE
dfTest$host_identity_verified[is.na(dfTest$host_identity_verified)] <- FALSE
dfTest$host_is_superhost[is.na(dfTest$host_is_superhost)] <- FALSE
```

#### Use zipcode for defining locations. 
Change zipcodes where have less than 5 airbnb homes and null values to "Other".  
This process can manage the null value and avoid new level(Did not appear in training set) appearing in the test set.
```{r}
smalllocation <- dfTrain %>%
  group_by(zipcode) %>%
  tally() %>%
  filter(n<5)
smalllocation
dfTrain$zipcode[dfTrain$zipcode %in% smalllocation$zipcode]<-"Other"
dfTrain$zipcode[is.na(dfTrain$zipcode)]<-"Other"

dfTrain%>%
  group_by(zipcode) %>%
  tally()
```

```{r include=FALSE}
#for test
smalllocation <- dfTest %>%
  group_by(zipcode) %>%
  tally() %>%
  filter(n<5)
smalllocation

dfTest$zipcode[dfTest$zipcode %in% smalllocation$zipcode]<-"Other"
dfTest$zipcode[is.na(dfTest$zipcode)]<-"Other"

dfTest%>%
  group_by(zipcode) %>%
  tally()
```

### Creating derived variables
#### Get meaningful ratios from numeric variables
1. Bathroom per room is an important factor that people will see when they buy or rent a house.
2. Bed per room can tell how many beds for one room on average.
3. We use "room" here instead of bedroom becuase bedroom can be zero. When the bedroom equals to 0 we used 1 to be the denominator. 1 here then represnts the room that the guest will stay no matter it is a living room or other room.
```{r}
dfTrain$availability_bathvsroom <- ifelse(dfTrain$bedrooms==0,dfTrain$bathrooms/1,dfTrain$bathrooms/dfTrain$bedrooms)
dfTrain$availability_bedvsroom <- ifelse(dfTrain$bedrooms==0,dfTrain$beds/1,dfTrain$beds/dfTrain$bedrooms)
dfTrain$pricevsroom <- ifelse(dfTrain$bedrooms==0,dfTrain$price/1,dfTrain$price/dfTrain$bedrooms)

dfTrain$cleaning_feevsprice <- dfTrain$cleaning_fee / dfTrain$price
dfTrain$security_depositvsprice <- dfTrain$security_deposit / dfTrain$price
dfTrain$monthly_pricevsprice <- dfTrain$monthly_price / dfTrain$price
dfTrain$weekly_pricevsprice <- dfTrain$weekly_price / dfTrain$price
dfTrain$extra_peoplevsprice <- dfTrain$extra_people / dfTrain$price
```

```{r include=FALSE}
# for test set
dfTest$availability_bathvsroom <- ifelse(dfTest$bedrooms==0,dfTest$bathrooms/1,dfTest$bathrooms/dfTest$bedrooms)
dfTest$availability_bedvsroom <- ifelse(dfTest$bedrooms==0,dfTest$beds/1,dfTest$beds/dfTest$bedrooms)
dfTest$pricevsroom <- ifelse(dfTest$bedrooms==0,dfTest$price/1,dfTest$price/dfTest$bedrooms)

dfTest$cleaning_feevsprice <- dfTest$cleaning_fee / dfTest$price
dfTest$security_depositvsprice <- dfTest$security_deposit / dfTest$price
dfTest$monthly_pricevsprice <- dfTest$monthly_price / dfTest$price
dfTest$weekly_pricevsprice <- dfTest$weekly_price / dfTest$price
dfTest$extra_peoplevsprice <- dfTest$extra_people / dfTest$price
```

#### Get length for text data
Length of text may indicate that information provided for customers.  
For example: Longer host_about may provide more information about the host for potential customer, a good self introduction may attract more customers
```{r}
dfTrain$access_length <- nchar(dfTrain$access)
dfTrain$description_length <- nchar(dfTrain$description)
dfTrain$host_about_length <- nchar(dfTrain$host_about)
dfTrain$interaction_length <- nchar(dfTrain$interaction)
dfTrain$notes_length <- nchar(dfTrain$notes)
dfTrain$transit_length <- nchar(dfTrain$transit)
dfTrain$house_rules_length <- nchar(dfTrain$house_rules)
dfTrain$space_length <- nchar(dfTrain$space)

dfTrain$access_length[is.na(dfTrain$access_length)] <- 0

dfTrain$description_length[is.na(dfTrain$description_length)] <- 0

dfTrain$host_about_length[is.na(dfTrain$host_about_length)] <-0

dfTrain$interaction_length[is.na(dfTrain$interaction_length)] <- 0

dfTrain$notes_length[is.na(dfTrain$notes_length)] <- 0

dfTrain$space_length[is.na(dfTrain$space_length)] <- 0

dfTrain$transit_length[is.na(dfTrain$transit_length)] <- 0

dfTrain$house_rules_length[is.na(dfTrain$house_rules_length)] <- 0
```

```{r include=FALSE}
# for test set
dfTest$access_length <- nchar(dfTest$access)
dfTest$description_length <- nchar(dfTest$description)
dfTest$host_about_length <- nchar(dfTest$host_about)
dfTest$interaction_length <- nchar(dfTest$interaction)
dfTest$notes_length <- nchar(dfTest$notes)
dfTest$transit_length <- nchar(dfTest$transit)
dfTest$house_rules_length <- nchar(dfTest$house_rules)
dfTest$space_length <- nchar(dfTest$space)
```

```{r include=FALSE}
#for test
dfTest$access_length[is.na(dfTest$access_length)] <-0

dfTest$description_length[is.na(dfTest$description_length)] <- 0

dfTest$host_about_length[is.na(dfTest$host_about_length)] <- 0

dfTest$interaction_length[is.na(dfTest$interaction_length)] <- 0

dfTest$notes_length[is.na(dfTest$notes_length)] <- 0

dfTest$space_length[is.na(dfTest$space_length)] <- 0

dfTest$transit_length[is.na(dfTest$transit_length)] <- 0

dfTest$house_rules_length[is.na(dfTest$house_rules_length)] <- 0
```

#### Keywards Extraction and Dummy Variables Creation
Extract keywords from description column, description give customers more information other than amenities. In description, customers can know about some interest facts around the destination.
```{r}
dfTrain$description_sea = 0 
dfTrain$description_sea[which(grepl(pattern = "sea",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_view = 0 
dfTrain$description_view[which(grepl(pattern = "water view",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_lake = 0 
dfTrain$description_lake[which(grepl(pattern = "lake",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_mountain = 0 
dfTrain$description_mountain[which(grepl(pattern = "mountain",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_museum = 0 
dfTrain$description_museum[which(grepl(pattern = "museum",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_beach = 0 
dfTrain$description_beach[which(grepl(pattern = "beach", ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_restaurant = 0 
dfTrain$description_restaurant[which(grepl(pattern = "restaurant", ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_shopping = 0 
dfTrain$description_shopping[which(grepl(pattern = "shopping",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_downtown = 0 
dfTrain$description_downtown[which(grepl(pattern = "downtown",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_university = 0 
dfTrain$description_university[which(grepl(pattern = "university",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_station = 0 
dfTrain$description_station[which(grepl(pattern = "station",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_balcony = 0 
dfTrain$description_balcony[which(grepl(pattern = "balcony",ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1

dfTrain$description_bars = 0 
dfTrain$description_bars[which(grepl(pattern = "bars", ignore.case =TRUE, x = dfTrain$description) == TRUE)] = 1
```

```{r include=FALSE}
#for test
dfTest$description_sea = 0 
dfTest$description_sea[which(grepl(pattern = "sea",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_view = 0 
dfTest$description_view[which(grepl(pattern = "water view",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_lake = 0 
dfTest$description_lake[which(grepl(pattern = "lake",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_mountain = 0 
dfTest$description_mountain[which(grepl(pattern = "mountain",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_museum = 0 
dfTest$description_museum[which(grepl(pattern = "museum",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_beach = 0 
dfTest$description_beach[which(grepl(pattern = "beach", ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_restaurant = 0 
dfTest$description_restaurant[which(grepl(pattern = "restaurant", ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_shopping = 0 
dfTest$description_shopping[which(grepl(pattern = "shopping",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_downtown = 0 
dfTest$description_downtown[which(grepl(pattern = "downtown",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_university = 0 
dfTest$description_university[which(grepl(pattern = "university",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_station = 0 
dfTest$description_station[which(grepl(pattern = "station",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_balcony = 0 
dfTest$description_balcony[which(grepl(pattern = "balcony",ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

dfTest$description_bars = 0 
dfTest$description_bars[which(grepl(pattern = "bars", ignore.case =TRUE, x = dfTest$description) == TRUE)] = 1

```

Break down amenities into sub amenities dummies
```{r}
dfTrain$amenities_wifi = 0 
dfTrain$amenities_wifi[which(grepl(pattern = "Wifi", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_air = 0 
dfTrain$amenities_air[which(grepl(pattern = "Air", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_pool = 0 
dfTrain$amenities_pool[which(grepl(pattern = "Pool", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_kitchen = 0 
dfTrain$amenities_kitchen[which(grepl(pattern = "Kitchen", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_free = 0 
dfTrain$amenities_free[which(grepl(pattern = "Free", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_heating = 0 
dfTrain$amenities_heating[which(grepl(pattern = "Heating", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_washer = 0 
dfTrain$amenities_washer[which(grepl(pattern = "Washer", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_dryer = 0 
dfTrain$amenities_dryer[which(grepl(pattern = "Dryer", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_smoke = 0 
dfTrain$amenities_smoke[which(grepl(pattern = "Smoke", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_carbon = 0 
dfTrain$amenities_carbon[which(grepl(pattern = "Carbon", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_aid = 0 
dfTrain$amenities_aid[which(grepl(pattern = "aid", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_essentials = 0 
dfTrain$amenities_essentials[which(grepl(pattern = "Essentials", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_shampoo = 0 
dfTrain$amenities_shampoo[which(grepl(pattern = "Shampoo", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_lock = 0 
dfTrain$amenities_lock[which(grepl(pattern = "Lock", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_hanger = 0 
dfTrain$amenities_hanger[which(grepl(pattern = "Hanger", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_hair = 0 
dfTrain$amenities_hair[which(grepl(pattern = "Hair", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_iron = 0 
dfTrain$amenities_iron[which(grepl(pattern = "Iron", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_laptop = 0 
dfTrain$amenities_laptop[which(grepl(pattern = "Laptop", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_private = 0 
dfTrain$amenities_private[which(grepl(pattern = "Private", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_host = 0 
dfTrain$amenities_host[which(grepl(pattern = "Host", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_tv = 0 
dfTrain$amenities_tv[which(grepl(pattern = "TV", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_internet = 0 
dfTrain$amenities_internet[which(grepl(pattern = "Internet", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_kid = 0 
dfTrain$amenities_kid[which(grepl(pattern = "kid", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_events = 0 
dfTrain$amenities_events[which(grepl(pattern = "events", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_safe = 0 
dfTrain$amenities_safe[which(grepl(pattern = "Safe", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_fire = 0 
dfTrain$amenities_fire[which(grepl(pattern = "Fire", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_pet = 0 
dfTrain$amenities_pet[which(grepl(pattern = "Pets", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_dog = 0 
dfTrain$amenities_dog[which(grepl(pattern = "Dog", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_water = 0 
dfTrain$amenities_water[which(grepl(pattern = "water", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_microwave = 0 
dfTrain$amenities_microwave[which(grepl(pattern = "Microwave", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_coffee = 0 
dfTrain$amenities_coffee[which(grepl(pattern = "Coffee", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_dishes = 0 
dfTrain$amenities_dishes[which(grepl(pattern = "Dishes", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_luggage = 0 
dfTrain$amenities_luggage[which(grepl(pattern = "Luggage", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_gym = 0 
dfTrain$amenities_gym[which(grepl(pattern = "Gym", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_elevator = 0 
dfTrain$amenities_elevator[which(grepl(pattern = "Elevator", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_essentials = 0 
dfTrain$amenities_essentials[which(grepl(pattern = "Essentials", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_selfcheckin = 0 
dfTrain$amenities_selfcheckin[which(grepl(pattern = "Self check-in", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_hottub = 0 
dfTrain$amenities_hottub[which(grepl(pattern ="tub", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_breakfast = 0 
dfTrain$amenities_breakfast[which(grepl(pattern ="Breakfast", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_24hour = 0 
dfTrain$amenities_24hour[which(grepl(pattern ="24", x = dfTrain$amenities) == TRUE)] = 1


dfTrain$amenities_oven = 0 
dfTrain$amenities_oven[which(grepl(pattern ="Oven", x = dfTrain$amenities) == TRUE)] = 1

dfTrain$amenities_stove = 0 
dfTrain$amenities_stove[which(grepl(pattern ="Stove", x = dfTrain$amenities) == TRUE)] = 1


dfTrain$amenities_bbq = 0 
dfTrain$amenities_bbq[which(grepl(pattern ="BBQ", x = dfTrain$amenities) == TRUE)] = 1

```

```{r include=FALSE}
#for test
dfTest$amenities_wifi = 0 
dfTest$amenities_wifi[which(grepl(pattern = "Wifi", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_air = 0 
dfTest$amenities_air[which(grepl(pattern = "Air", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_pool = 0 
dfTest$amenities_pool[which(grepl(pattern = "Pool", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_kitchen = 0 
dfTest$amenities_kitchen[which(grepl(pattern = "Kitchen", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_free = 0 
dfTest$amenities_free[which(grepl(pattern = "Free", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_heating = 0 
dfTest$amenities_heating[which(grepl(pattern = "Heating", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_washer = 0 
dfTest$amenities_washer[which(grepl(pattern = "Washer", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_dryer = 0 
dfTest$amenities_dryer[which(grepl(pattern = "Dryer", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_smoke = 0 
dfTest$amenities_smoke[which(grepl(pattern = "Smoke", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_carbon = 0 
dfTest$amenities_carbon[which(grepl(pattern = "Carbon", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_aid = 0 
dfTest$amenities_aid[which(grepl(pattern = "aid", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_essentials = 0 
dfTest$amenities_essentials[which(grepl(pattern = "Essentials", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_shampoo = 0 
dfTest$amenities_shampoo[which(grepl(pattern = "Shampoo", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_lock = 0 
dfTest$amenities_lock[which(grepl(pattern = "Lock", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_hanger = 0 
dfTest$amenities_hanger[which(grepl(pattern = "Hanger", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_hair = 0 
dfTest$amenities_hair[which(grepl(pattern = "Hair", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_iron = 0 
dfTest$amenities_iron[which(grepl(pattern = "Iron", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_laptop = 0 
dfTest$amenities_laptop[which(grepl(pattern = "Laptop", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_private = 0 
dfTest$amenities_private[which(grepl(pattern = "Private", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_host = 0 
dfTest$amenities_host[which(grepl(pattern = "Host", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_tv = 0 
dfTest$amenities_tv[which(grepl(pattern = "TV", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_internet = 0 
dfTest$amenities_internet[which(grepl(pattern = "Internet", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_kid = 0 
dfTest$amenities_kid[which(grepl(pattern = "kid", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_events = 0 
dfTest$amenities_events[which(grepl(pattern = "events", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_safe = 0 
dfTest$amenities_safe[which(grepl(pattern = "Safe", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_fire = 0 
dfTest$amenities_fire[which(grepl(pattern = "Fire", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_pet = 0 
dfTest$amenities_pet[which(grepl(pattern = "Pets", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_dog = 0 
dfTest$amenities_dog[which(grepl(pattern = "Dog", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_water = 0 
dfTest$amenities_water[which(grepl(pattern = "water", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_microwave = 0 
dfTest$amenities_microwave[which(grepl(pattern = "Microwave", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_coffee = 0 
dfTest$amenities_coffee[which(grepl(pattern = "Coffee", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_dishes = 0 
dfTest$amenities_dishes[which(grepl(pattern = "Dishes", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_luggage = 0 
dfTest$amenities_luggage[which(grepl(pattern = "Luggage", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_gym = 0 
dfTest$amenities_gym[which(grepl(pattern = "Gym", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_elevator = 0 
dfTest$amenities_elevator[which(grepl(pattern = "Elevator", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_essentials = 0 
dfTest$amenities_essentials[which(grepl(pattern = "Essentials", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_selfcheckin = 0 
dfTest$amenities_selfcheckin[which(grepl(pattern = "Self check-in", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_hottub = 0 
dfTest$amenities_hottub[which(grepl(pattern ="tub", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_breakfast = 0 
dfTest$amenities_breakfast[which(grepl(pattern ="Breakfast", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_24hour = 0 
dfTest$amenities_24hour[which(grepl(pattern ="24", x = dfTest$amenities) == TRUE)] = 1


dfTest$amenities_oven = 0 
dfTest$amenities_oven[which(grepl(pattern ="Oven", x = dfTest$amenities) == TRUE)] = 1

dfTest$amenities_stove = 0 
dfTest$amenities_stove[which(grepl(pattern ="Stove", x = dfTest$amenities) == TRUE)] = 1


dfTest$amenities_bbq = 0 
dfTest$amenities_bbq[which(grepl(pattern ="BBQ", x = dfTest$amenities) == TRUE)] = 1

```

Break down verification methods into dummies. Verification is essential for proving the reliability for the host
```{r}
dfTrain$host_verifications_email = 0 
dfTrain$host_verifications_email[which(grepl(pattern = "email", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_phone = 0 
dfTrain$host_verifications_phone[which(grepl(pattern = "phone", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_jumio = 0 
dfTrain$host_verifications_jumio[which(grepl(pattern = "jumio", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_gover = 0 
dfTrain$host_verifications_gover[which(grepl(pattern = "gover", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_self = 0 
dfTrain$host_verifications_self[which(grepl(pattern = "self", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_identity = 0 
dfTrain$host_verifications_identity[which(grepl(pattern = "identity", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_facebook = 0 
dfTrain$host_verifications_facebook[which(grepl(pattern = "facebook", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_kba = 0 
dfTrain$host_verifications_kba[which(grepl(pattern = "kba", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_review = 0 
dfTrain$host_verifications_review[which(grepl(pattern = "review", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_google = 0 
dfTrain$host_verifications_google[which(grepl(pattern = "google", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_online = 0 
dfTrain$host_verifications_online[which(grepl(pattern = "online", x = dfTrain$host_verifications) == TRUE)] = 1

dfTrain$host_verifications_offline = 0 
dfTrain$host_verifications_offline[which(grepl(pattern = "offline", x = dfTrain$host_verifications) == TRUE)] = 1

```

```{r include=FALSE}
#for test
dfTest$host_verifications_email = 0 
dfTest$host_verifications_email[which(grepl(pattern = "email", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_phone = 0 
dfTest$host_verifications_phone[which(grepl(pattern = "phone", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_jumio = 0 
dfTest$host_verifications_jumio[which(grepl(pattern = "jumio", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_gover = 0 
dfTest$host_verifications_gover[which(grepl(pattern = "gover", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_self = 0 
dfTest$host_verifications_self[which(grepl(pattern = "self", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_identity = 0 
dfTest$host_verifications_identity[which(grepl(pattern = "identity", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_facebook = 0 
dfTest$host_verifications_facebook[which(grepl(pattern = "facebook", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_kba = 0 
dfTest$host_verifications_kba[which(grepl(pattern = "kba", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_review = 0 
dfTest$host_verifications_review[which(grepl(pattern = "review", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_google = 0 
dfTest$host_verifications_google[which(grepl(pattern = "google", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_online = 0 
dfTest$host_verifications_online[which(grepl(pattern = "online", x = dfTest$host_verifications) == TRUE)] = 1

dfTest$host_verifications_offline = 0 
dfTest$host_verifications_offline[which(grepl(pattern = "offline", x = dfTest$host_verifications) == TRUE)] = 1

```

Divided cancellation_policy to three main types
```{r}
dfTrain %>%
  group_by(cancellation_policy) %>%
  tally()

dfTrain$cancellation_flexible = 0 
dfTrain$cancellation_flexible[which(grepl(pattern = "flexible", x = dfTrain$cancellation_policy) == TRUE)] = 1

dfTrain$cancellation_moderate = 0 
dfTrain$cancellation_moderate[which(grepl(pattern = "moderate", x = dfTrain$cancellation_policy) == TRUE)] = 1

dfTrain$cancellation_strict = 0 
dfTrain$cancellation_strict[which(grepl(pattern = "strict", x = dfTrain$cancellation_policy) == TRUE)] = 1

```

```{r include=FALSE}
#for test
dfTest %>%
  group_by(cancellation_policy) %>%
  tally()

dfTest$cancellation_flexible = 0 
dfTest$cancellation_flexible[which(grepl(pattern = "flexible", x = dfTest$cancellation_policy) == TRUE)] = 1

dfTest$cancellation_moderate = 0 
dfTest$cancellation_moderate[which(grepl(pattern = "moderate", x = dfTest$cancellation_policy) == TRUE)] = 1

dfTest$cancellation_strict = 0 
dfTest$cancellation_strict[which(grepl(pattern = "strict", x = dfTest$cancellation_policy) == TRUE)] = 1

```

Sentiment Analysis for neighborhood_overview.  
Creat new dummy variable named neighborhood_overview_positive to record if the neighborhood overview is positive or negative.
```{r}
dfTidy <-
  dfTrain %>%
  unnest_tokens(word, neighborhood_overview)

dfTidy <-
  dfTidy %>% 
  anti_join(stop_words)

dfTidy <-
  dfTidy %>%
  select(id, word)
dfTidy

sentimentBING <-
  dfTidy %>% 
  inner_join(get_sentiments("bing")) %>% 
  count(id, sentiment) %>%
  spread(sentiment, n, fill=0) %>%
  mutate(score = log(positive+0.5) - log(negative+0.5)) %>% 
  setNames(c(names(.)[1],paste0('BING', names(.)[-1])))

dfTrain<-left_join(dfTrain,sentimentBING,by="id")

dfTrain$neighborhood_overview_positive=0
dfTrain$neighborhood_overview_positive[dfTrain$BINGscore>0]=1
dfTrain$neighborhood_overview_positive[is.na(dfTrain$BINGscore)]=0
dfTrain$neighborhood_overview_positive[is.nan(dfTrain$BINGscore)]=0
```

```{r include=FALSE}
#for test
dfTidy <-
  dfTest %>%
  unnest_tokens(word, neighborhood_overview)
dfTidy <-
  dfTidy %>% 
  anti_join(stop_words)

dfTidy <-
  dfTidy %>%
  select(id, word)
dfTidy

sentimentBING <-
  dfTidy %>% 
  inner_join(get_sentiments("bing")) %>% 
  count(id, sentiment) %>%
  spread(sentiment, n, fill=0) %>%
  mutate(score = log(positive+0.5) - log(negative+0.5)) %>% 
  setNames(c(names(.)[1],paste0('BING', names(.)[-1])))

dfTest<-left_join(dfTest,sentimentBING,by="id")

dfTest$neighborhood_overview_positive=0
dfTest$neighborhood_overview_positive[dfTest$BINGscore>0]=1
dfTest$neighborhood_overview_positive[is.na(dfTest$BINGscore)]=0
dfTest$neighborhood_overview_positive[is.nan(dfTest$BINGscore)]=0
```

## Predictive Model
### Remove variables will not included in the model
```{r}
trainx<- subset(dfTrain,select=-c(id,host_location,host_neighbourhood,neighbourhood,latitude,longitude,`{randomControl}`,host_acceptance_rate,square_feet,neighborhood_overview,BINGnegative,BINGpositive,BINGscore,state,market,city,access,description,host_about,interaction,notes,transit,house_rules,space,host_verifications,amenities,cancellation_policy))
```

### Variables included in the model
#### Original Variables:
"accommodates", "availability_30", "availability_365","availability_60", "availability_90", "bathrooms", "bed_type", "bedrooms", "beds" , "cleaning_fee", "extra_people", "guests_included", "host_has_profile_pic", "host_identity_verified", "host_is_superhost", "host_listings_count", "host_response_rate", "host_response_time", "host_since", "instant_bookable", "is_business_travel_ready", "is_location_exact", "maximum_nights", "minimum_nights", "monthly_price", "price", "property_type", "require_guest_phone_verification", "require_guest_profile_picture",   "requires_license", "review_scores_accuracy", "review_scores_checkin", "review_scores_cleanliness", "review_scores_communication", "review_scores_location", "review_scores_rating", "review_scores_value", "room_type", "security_deposit", "weekly_price", "zipcode"  

#### Ratios:
"availability_bathvsroom", "availability_bedvsroom", "pricevsroom", "cleaning_feevsprice", "security_depositvsprice", "monthly_pricevsprice", "weekly_pricevsprice", "extra_peoplevsprice"  

#### TextLength:
"access_length", "host_about_length", "interaction_length", "notes_length", "transit_length", "house_rules_length", "space_length"  

#### description:
"description_length", "description_sea", "description_view", "description_lake", "description_mountain", "description_museum", "description_beach",  "description_restaurant", "description_shopping", "description_downtown", "description_university", "description_station", "description_balcony", "description_bars"    

#### amentities:
"amenities_wifi","amenities_air, "amenities_pool", "amenities_kitchen", "amenities_free", "amenities_heating", "amenities_washer", "amenities_dryer", "amenities_smoke", "amenities_carbon", "amenities_aid", "amenities_essentials", "amenities_shampoo", "amenities_lock", "amenities_hanger", "amenities_hair", "amenities_iron", "amenities_laptop", "amenities_private", "amenities_host", "amenities_tv", "amenities_internet", "amenities_kid", "amenities_events", "amenities_safe", "amenities_fire", "amenities_pet", "amenities_dog", "amenities_water", "amenities_microwave", "amenities_coffee", "amenities_dishes", "amenities_luggage", "amenities_gym", "amenities_elevator", "amenities_selfcheckin", "amenities_hottub", "amenities_breakfast", "amenities_24hour", "amenities_oven", "amenities_stove", "amenities_bbq"      

#### host_verifications:
"host_verifications_email", "host_verifications_phone", "host_verifications_jumio", "host_verifications_gover", "host_verifications_self", "host_verifications_identity", "host_verifications_facebook", "host_verifications_kba", "host_verifications_review", "host_verifications_google", "host_verifications_online", "host_verifications_offline"  

#### cancellation_policy:  
"cancellation_flexible", "cancellation_moderate", "cancellation_strict"  

#### neighborhood_overview:         
"neighborhood_overview_positive"  

### Change high_booking_rate colums into factor and replace 1/0 to X1_class/X0_class
```{r}
levels(trainx$high_booking_rate) <- c("0_class", "1_class")
trainx<-trainx  %>% 
  mutate(high_booking_rate = factor(high_booking_rate, 
          labels = make.names(levels(high_booking_rate))))
trainx
```
### XGBoost model based on the Kaggle part
```{r}
trctrl <- trainControl(method = "cv", number = 10,
  classProbs = TRUE,
  verboseIter = TRUE,
  summaryFunction = prSummary,
  savePredictions = TRUE,
  allowParallel = TRUE)

tune_grid <- expand.grid(nrounds = 300,
                        max_depth = 10,
                        eta = 0.05,
                        gamma = 0.01,
                        colsample_bytree = 0.75,
                        min_child_weight = 0,
                        subsample = 0.6)

xgb_fit <- train(as.factor(high_booking_rate) ~., data = trainx, method = "xgbTree",
                trControl=trctrl,
                metric = "AUC",
                tuneGrid = tune_grid,
                tuneLength = 10)

# have a look at the model 
xgb_fit
```


```{r include=FALSE}
small <- dfTest %>%
  group_by(property_type) %>%
  tally() %>%
  filter(n<5)

dfTest$property_type[dfTest$property_type %in% small$property_type]<-"Other"
```
### Prediction Results
```{r}
results <-
  xgb_fit%>%
  predict(dfTest, type = 'prob') %>%	 
  bind_cols(dfTest, predictedProb=.) 
results
```
### Draw Accuracy, Sensitivity, Specificity VS Cutoff
```{r}
class <- results$high_booking_rate
score <- results$X1_class
measure <- measureit(score = score, class = class,
                     measure = c("ACC", "SENS", "SPEC"))
names(measure)
#> [1] "Cutoff" "Depth"  "TP"     "FP"     "TN"     "FN"     "ACC"    "SENS"  
#> [9] "FSCR"
plot1<-plot(measure$ACC~measure$Cutoff, type = "l")
plot2<-plot(measure$SENS~measure$Cutoff, type = "l")
plot3<-plot(measure$SPEC~measure$Cutoff, type = "l")
```

#### High sensitivity
```{r}
results1<-results%>% 
  mutate(predictedClass = ifelse(X1_class > 0.15, 1, 0))

results1<-
  results1 %>%
  mutate(high_booking_rate = as.factor(high_booking_rate), predictedClass = as.factor(predictedClass))

results1 %>% 
  xtabs(~predictedClass+high_booking_rate, .) %>% 
  confusionMatrix(positive = '1')
```

#### High specificity
```{r}
results2<-results%>% 
  mutate(predictedClass = ifelse(X1_class > 0.65, 1, 0))

results2<-
  results2 %>%
  mutate(high_booking_rate = as.factor(high_booking_rate), predictedClass = as.factor(predictedClass))

results2 %>% 
  xtabs(~predictedClass+high_booking_rate, .) %>% 
  confusionMatrix(positive = '1')
```

## Exploratory data analysis
```{r include=FALSE}
#Data cleaning for df
df$cleaning_fee<-gsub("\\$","",df$cleaning_fee)#remove dollar sign
df$monthly_price<-gsub("\\$","",df$monthly_price)
df$price<-gsub("\\$","",df$price)
df$security_deposit<-gsub("\\$","",df$security_deposit)
df$weekly_price<-gsub("\\$","",df$weekly_price)
df$extra_people<-gsub("\\$","",df$extra_people)

df$cleaning_fee <- as.numeric(df$cleaning_fee)
df$monthly_price <- as.numeric(df$monthly_price)
df$price <- as.numeric(df$price)
df$security_deposit <- as.numeric(df$security_deposit)
df$weekly_price <- as.numeric(df$weekly_price)
df$extra_people <- as.numeric(df$extra_people)

df$host_response_rate <- as.numeric(sub("%", "",df$host_response_rate,fixed=TRUE))/100

df$host_response_rate[is.na(df$host_response_rate)] <- median(df$host_response_rate, na.rm=TRUE)

df$host_listings_count[is.na(df$host_listings_count)] <- 0

df$review_scores_value[is.na(df$review_scores_value)] <- 0

df$review_scores_rating[is.na(df$review_scores_rating)] <-0

df$review_scores_location[is.na(df$review_scores_location)] <-0

df$review_scores_communication[is.na(df$review_scores_communication)] <- 0

df$review_scores_cleanliness[is.na(df$review_scores_cleanliness)] <- 0

df$review_scores_checkin[is.na(df$review_scores_checkin)] <- 0

df$review_scores_accuracy[is.na(df$review_scores_accuracy)] <- 0

df$beds[is.na(df$beds)] <- median(df$beds, na.rm=TRUE)

df$bedrooms[is.na(df$bedrooms)] <- median(df$bedrooms, na.rm=TRUE)

df$bathrooms[is.na(df$bathrooms)] <- median(df$bathrooms, na.rm=TRUE)

df$extra_people[is.na(df$extra_people)] <- mean(df$extra_people, na.rm=TRUE)

df$security_deposit[is.na(df$security_deposit)] <- mean(df$security_deposit, na.rm=TRUE)

df$cleaning_fee[is.na(df$cleaning_fee)] <- mean(df$cleaning_fee, na.rm=TRUE)

df$price[is.na(df$price)] <- mean(df$price, na.rm=TRUE)

df$price[df$price==0] <- mean(df$price, na.rm=TRUE)

df$weekly_price<-ifelse(is.na(df$weekly_price),df$price*7,df$weekly_price)

df$monthly_price<-ifelse(is.na(df$monthly_price),df$price*30,df$monthly_price)

df$host_since <- year(df$host_since)
df$host_since[is.na(df$host_since)] <-"Unknown"

df$host_response_time[is.na(df$host_response_time)] <- "Other"
df$host_response_time[df$host_response_time == 'N/A'] <- 'Other'

df %>%
  group_by(host_has_profile_pic ) %>%
  tally()
df %>%
  group_by(host_identity_verified ) %>%
  tally()
df %>%
  group_by(host_is_superhost ) %>%
  tally() 
df$host_has_profile_pic[is.na(df$host_has_profile_pic)] <- FALSE
df$host_identity_verified[is.na(df$host_identity_verified)] <- FALSE
df$host_is_superhost[is.na(df$host_is_superhost)] <- FALSE

df$availability_bathvsroom <- ifelse(df$bedrooms==0,df$bathrooms/1,df$bathrooms/df$bedrooms)
df$availability_bedvsroom <- ifelse(df$bedrooms==0,df$beds/1,df$beds/df$bedrooms)
df$pricevsroom <- ifelse(df$bedrooms==0,df$price/1,df$price/df$bedrooms)

df$cleaning_feevsprice <- df$cleaning_fee / df$price
df$security_depositvsprice <- df$security_deposit / df$price
df$monthly_pricevsprice <- df$monthly_price / df$price
df$weekly_pricevsprice <- df$weekly_price / df$price
df$extra_peoplevsprice <- df$extra_people / df$price

df$description_sea = 0 
df$description_sea[which(grepl(pattern = "sea",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_view = 0 
df$description_view[which(grepl(pattern = "water view",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_lake = 0 
df$description_lake[which(grepl(pattern = "lake",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_mountain = 0 
df$description_mountain[which(grepl(pattern = "mountain",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_museum = 0 
df$description_museum[which(grepl(pattern = "museum",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_beach = 0 
df$description_beach[which(grepl(pattern = "beach", ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_restaurant = 0 
df$description_restaurant[which(grepl(pattern = "restaurant", ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_shopping = 0 
df$description_shopping[which(grepl(pattern = "shopping",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_downtown = 0 
df$description_downtown[which(grepl(pattern = "downtown",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_university = 0 
df$description_university[which(grepl(pattern = "university",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_station = 0 
df$description_station[which(grepl(pattern = "station",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_balcony = 0 
df$description_balcony[which(grepl(pattern = "balcony",ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$description_bars = 0 
df$description_bars[which(grepl(pattern = "bars", ignore.case =TRUE, x = df$description) == TRUE)] = 1

df$amenities_wifi = 0 
df$amenities_wifi[which(grepl(pattern = "Wifi", x = df$amenities) == TRUE)] = 1

df$amenities_air = 0 
df$amenities_air[which(grepl(pattern = "Air", x = df$amenities) == TRUE)] = 1

df$amenities_pool = 0 
df$amenities_pool[which(grepl(pattern = "Pool", x = df$amenities) == TRUE)] = 1

df$amenities_kitchen = 0 
df$amenities_kitchen[which(grepl(pattern = "Kitchen", x = df$amenities) == TRUE)] = 1

df$amenities_free = 0 
df$amenities_free[which(grepl(pattern = "Free", x = df$amenities) == TRUE)] = 1

df$amenities_heating = 0 
df$amenities_heating[which(grepl(pattern = "Heating", x = df$amenities) == TRUE)] = 1

df$amenities_washer = 0 
df$amenities_washer[which(grepl(pattern = "Washer", x = df$amenities) == TRUE)] = 1

df$amenities_dryer = 0 
df$amenities_dryer[which(grepl(pattern = "Dryer", x = df$amenities) == TRUE)] = 1

df$amenities_smoke = 0 
df$amenities_smoke[which(grepl(pattern = "Smoke", x = df$amenities) == TRUE)] = 1

df$amenities_carbon = 0 
df$amenities_carbon[which(grepl(pattern = "Carbon", x = df$amenities) == TRUE)] = 1

df$amenities_aid = 0 
df$amenities_aid[which(grepl(pattern = "aid", x = df$amenities) == TRUE)] = 1

df$amenities_essentials = 0 
df$amenities_essentials[which(grepl(pattern = "Essentials", x = df$amenities) == TRUE)] = 1

df$amenities_shampoo = 0 
df$amenities_shampoo[which(grepl(pattern = "Shampoo", x = df$amenities) == TRUE)] = 1

df$amenities_lock = 0 
df$amenities_lock[which(grepl(pattern = "Lock", x = df$amenities) == TRUE)] = 1

df$amenities_hanger = 0 
df$amenities_hanger[which(grepl(pattern = "Hanger", x = df$amenities) == TRUE)] = 1

df$amenities_hair = 0 
df$amenities_hair[which(grepl(pattern = "Hair", x = df$amenities) == TRUE)] = 1

df$amenities_iron = 0 
df$amenities_iron[which(grepl(pattern = "Iron", x = df$amenities) == TRUE)] = 1

df$amenities_laptop = 0 
df$amenities_laptop[which(grepl(pattern = "Laptop", x = df$amenities) == TRUE)] = 1

df$amenities_private = 0 
df$amenities_private[which(grepl(pattern = "Private", x = df$amenities) == TRUE)] = 1

df$amenities_host = 0 
df$amenities_host[which(grepl(pattern = "Host", x = df$amenities) == TRUE)] = 1

df$amenities_tv = 0 
df$amenities_tv[which(grepl(pattern = "TV", x = df$amenities) == TRUE)] = 1

df$amenities_internet = 0 
df$amenities_internet[which(grepl(pattern = "Internet", x = df$amenities) == TRUE)] = 1

df$amenities_kid = 0 
df$amenities_kid[which(grepl(pattern = "kid", x = df$amenities) == TRUE)] = 1

df$amenities_events = 0 
df$amenities_events[which(grepl(pattern = "events", x = df$amenities) == TRUE)] = 1

df$amenities_safe = 0 
df$amenities_safe[which(grepl(pattern = "Safe", x = df$amenities) == TRUE)] = 1

df$amenities_fire = 0 
df$amenities_fire[which(grepl(pattern = "Fire", x = df$amenities) == TRUE)] = 1

df$amenities_pet = 0 
df$amenities_pet[which(grepl(pattern = "Pets", x = df$amenities) == TRUE)] = 1

df$amenities_dog = 0 
df$amenities_dog[which(grepl(pattern = "Dog", x = df$amenities) == TRUE)] = 1

df$amenities_water = 0 
df$amenities_water[which(grepl(pattern = "water", x = df$amenities) == TRUE)] = 1

df$amenities_microwave = 0 
df$amenities_microwave[which(grepl(pattern = "Microwave", x = df$amenities) == TRUE)] = 1

df$amenities_coffee = 0 
df$amenities_coffee[which(grepl(pattern = "Coffee", x = df$amenities) == TRUE)] = 1

df$amenities_dishes = 0 
df$amenities_dishes[which(grepl(pattern = "Dishes", x = df$amenities) == TRUE)] = 1

df$amenities_luggage = 0 
df$amenities_luggage[which(grepl(pattern = "Luggage", x = df$amenities) == TRUE)] = 1

df$amenities_gym = 0 
df$amenities_gym[which(grepl(pattern = "Gym", x = df$amenities) == TRUE)] = 1

df$amenities_elevator = 0 
df$amenities_elevator[which(grepl(pattern = "Elevator", x = df$amenities) == TRUE)] = 1

df$amenities_essentials = 0 
df$amenities_essentials[which(grepl(pattern = "Essentials", x = df$amenities) == TRUE)] = 1

df$amenities_selfcheckin = 0 
df$amenities_selfcheckin[which(grepl(pattern = "Self check-in", x = df$amenities) == TRUE)] = 1

df$amenities_hottub = 0 
df$amenities_hottub[which(grepl(pattern ="tub", x = df$amenities) == TRUE)] = 1

df$amenities_breakfast = 0 
df$amenities_breakfast[which(grepl(pattern ="Breakfast", x = df$amenities) == TRUE)] = 1

df$amenities_24hour = 0 
df$amenities_24hour[which(grepl(pattern ="24", x = df$amenities) == TRUE)] = 1


df$amenities_oven = 0 
df$amenities_oven[which(grepl(pattern ="Oven", x = df$amenities) == TRUE)] = 1

df$amenities_stove = 0 
df$amenities_stove[which(grepl(pattern ="Stove", x = df$amenities) == TRUE)] = 1


df$amenities_bbq = 0 
df$amenities_bbq[which(grepl(pattern ="BBQ", x = df$amenities) == TRUE)] = 1


df$host_verifications_email = 0 
df$host_verifications_email[which(grepl(pattern = "email", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_phone = 0 
df$host_verifications_phone[which(grepl(pattern = "phone", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_jumio = 0 
df$host_verifications_jumio[which(grepl(pattern = "jumio", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_gover = 0 
df$host_verifications_gover[which(grepl(pattern = "gover", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_self = 0 
df$host_verifications_self[which(grepl(pattern = "self", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_identity = 0 
df$host_verifications_identity[which(grepl(pattern = "identity", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_facebook = 0 
df$host_verifications_facebook[which(grepl(pattern = "facebook", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_kba = 0 
df$host_verifications_kba[which(grepl(pattern = "kba", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_review = 0 
df$host_verifications_review[which(grepl(pattern = "review", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_google = 0 
df$host_verifications_google[which(grepl(pattern = "google", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_online = 0 
df$host_verifications_online[which(grepl(pattern = "online", x = df$host_verifications) == TRUE)] = 1

df$host_verifications_offline = 0 
df$host_verifications_offline[which(grepl(pattern = "offline", x = df$host_verifications) == TRUE)] = 1


df %>%
  group_by(cancellation_policy) %>%
  tally()

df$cancellation_flexible = 0 
df$cancellation_flexible[which(grepl(pattern = "flexible", x = df$cancellation_policy) == TRUE)] = 1

df$cancellation_moderate = 0 
df$cancellation_moderate[which(grepl(pattern = "moderate", x = df$cancellation_policy) == TRUE)] = 1

df$cancellation_strict = 0 
df$cancellation_strict[which(grepl(pattern = "strict", x = df$cancellation_policy) == TRUE)] = 1


dfTidy <-
  df %>%
  unnest_tokens(word, neighborhood_overview)

dfTidy <-
  dfTidy %>% 
  anti_join(stop_words)

dfTidy <-
  dfTidy %>%
  select(id, word)
dfTidy

sentimentBING <-
  dfTidy %>% 
  inner_join(get_sentiments("bing")) %>% 
  count(id, sentiment) %>%
  spread(sentiment, n, fill=0) %>%
  mutate(score = log(positive+0.5) - log(negative+0.5)) %>% 
  setNames(c(names(.)[1],paste0('BING', names(.)[-1])))

df<-left_join(df,sentimentBING,by="id")

df$neighborhood_overview_positive=0
df$neighborhood_overview_positive[df$BINGscore>0]=1
df$neighborhood_overview_positive[is.na(df$BINGscore)]=0
df$neighborhood_overview_positive[is.nan(df$BINGscore)]=0
```

### Location Selection: By using zipcode as our index, we grouped all Airbnb houses within certain locations and calculated the proportion of houses that have high booking rate in each location to help us determine whether a location is popular among Airbnb users, and then we sorted Top 10 locations.
```{r}
df$neighbourhood[is.na(df$neighbourhood)] <- "Other"
df %>%
  group_by(neighbourhood ) %>%
  tally()
```

#### Calculate the Number of airbnb homes that getting high booking rate in each location.
```{r}
df1<-
  df %>%
  group_by(zipcode) %>%
  mutate(sum_high = sum(high_booking_rate))
head(df1)

dfNumber<-
  df1 %>%
  group_by(zipcode) %>%
  tally() %>%
  filter(n>10)
dfNumber
```

#### Merge the two dataframes
```{r}
total <- 
  merge(dfNumber,df1,by="zipcode")
total
```

#### Calculate the Proportion of the Airbnb homes that has high booking rate in each location.
```{r}
total<-
  total %>%
  group_by(zipcode) %>%
  mutate(rate = sum_high/n) 
total

totalNoDuplicate <- total[!duplicated(total$zipcode),]
```

#### Select zipcode, sum of high_booking rate, n(number of airbnb homes), proportion rate column and filter the top 10 locations according to the proportion of having high booking rate.
```{r}
total_rank<-
  totalNoDuplicate %>%
  select(zipcode, sum_high, n, rate) %>%
  arrange(desc(rate))
total_rank
head(total_rank,10)
```
The top 10 location with high proportion of having high booking rate are: 92104,92102,92116,92107,92121,92113,92105,92114,92110,92106(zipcode)

### Neighborhood Selection: We divided the top 10 location into 5 popular areas and then we found out the top 10 neighborhood that has high proportion of having high booking rates in each area.
#### Found the top 10 neighborhoods that has high proportion of having high booking rate in the area that contained three locations: 92104, 92102, 92116. (Three locations are near each other)
```{r}
dfNeighbor1<-
  df %>%
  filter(zipcode %in% c(92104, 92102, 92116)) %>%
  group_by(neighbourhood) %>%
  mutate(sum_high_neighbor = sum(high_booking_rate)) %>%
  select(neighbourhood, sum_high_neighbor)

dfNeighbor_NumOfHomes1<-
  dfNeighbor1 %>%
  group_by(neighbourhood) %>%
  tally()

total_nei1 <- merge(dfNeighbor_NumOfHomes1, dfNeighbor1, by = "neighbourhood")

total_nei1<-
  total_nei1 %>%
  mutate(neigh_rate = sum_high_neighbor/n)

totalNeiNoDuplicate1 <- total_nei1[!duplicated(total_nei1$neighbourhood),]

total_nei_rank1<-
  totalNeiNoDuplicate1 %>%
  select(neighbourhood, sum_high_neighbor, n, neigh_rate) %>%
  arrange(desc(neigh_rate))
total_nei_rank1
total_nei_top10<-head(total_nei_rank1,10)
total_nei_top10
```
The neighbourhood that has highest proportion of having high booking rate in this area is Balboa Park


#### Found the top 10 neighborhoods according to the proportion of having high booking rates in each neighborhood in the area that contained two locations: 92107, 92106. (Two locations are next to each other)
```{r}
dfNeighbor2<-
  df %>%
  filter(zipcode %in% c(92107, 92106)) %>%
  group_by(neighbourhood) %>%
  mutate(sum_high_neighbor = sum(high_booking_rate)) %>%
  select(neighbourhood, sum_high_neighbor)

dfNeighbor_NumOfHomes2<-
  dfNeighbor2 %>%
  group_by(neighbourhood) %>%
  tally()

total_nei2 <- merge(dfNeighbor_NumOfHomes2, dfNeighbor2, by = "neighbourhood")

total_nei2<-
  total_nei2 %>%
  mutate(neigh_rate = sum_high_neighbor/n)

totalNeiNoDuplicate2 <- total_nei2[!duplicated(total_nei2$neighbourhood),]

total_nei_rank2<-
  totalNeiNoDuplicate2 %>%
  select(neighbourhood, sum_high_neighbor, n, neigh_rate) %>%
  arrange(desc(neigh_rate))
total_nei_rank2
total_nei_top10_2<-head(total_nei_rank2,10)
total_nei_top10_2
```
The neighbourhood that has highest proportion of having high booking rate in this area is Wooded Area.


#### Found the top 10 neighborhoods according to the proportion of having high booking rates in each neighborhood in the area that contained two locations: 92113, 92114. (Two locations are next to each other)
```{r}
dfNeighbor3<-
  df %>%
  filter(zipcode %in% c(92113, 92114)) %>%
  group_by(neighbourhood) %>%
  mutate(sum_high_neighbor = sum(high_booking_rate)) %>%
  select(neighbourhood, sum_high_neighbor)

dfNeighbor_NumOfHomes3<-
  dfNeighbor3 %>%
  group_by(neighbourhood) %>%
  tally()

total_nei3 <- merge(dfNeighbor_NumOfHomes3, dfNeighbor3, by = "neighbourhood")

total_nei3<-
  total_nei3 %>%
  mutate(neigh_rate = sum_high_neighbor/n)
totalNeiNoDuplicate3 <- total_nei3[!duplicated(total_nei3$neighbourhood),]
total_nei_rank3<-
  totalNeiNoDuplicate3 %>%
  select(neighbourhood, sum_high_neighbor, n, neigh_rate) %>%
  arrange(desc(neigh_rate))
total_nei_top10_3<-head(total_nei_rank3,10)
total_nei_top10_3
```
The neighbourhood that has highest proportion of having high booking rate in this area is Southcrest.


#### Found the top 10 neighborhoods according to the proportion of having high booking rates in each neighborhood in the area: 92105. 
```{r}
dfNeighbor4<-
  df %>%
  filter(zipcode ==92105) %>%
  group_by(neighbourhood) %>%
  mutate(sum_high_neighbor = sum(high_booking_rate)) %>%
  select(neighbourhood, sum_high_neighbor)

dfNeighbor_NumOfHomes4<-
  dfNeighbor4 %>%
  group_by(neighbourhood) %>%
  tally()

total_nei4 <- merge(dfNeighbor_NumOfHomes4, dfNeighbor4, by = "neighbourhood")

total_nei4<-
  total_nei4 %>%
  mutate(neigh_rate = sum_high_neighbor/n)
total_nei4

totalNeiNoDuplicate4 <- total_nei4[!duplicated(total_nei4$neighbourhood),]

total_nei_rank4<-
  totalNeiNoDuplicate4 %>%
  select(neighbourhood, sum_high_neighbor, n, neigh_rate) %>%
  arrange(desc(neigh_rate))
total_nei_top10_4<-head(total_nei_rank4,10)

total_nei_top10_4
```
The neighbourhood that has highest proportion of having high booking rate in this area is Fairmont Park.


#### Found the top 10 neighborhoods according to the proportion of having high booking rates in each neighborhood in the area: 92110. 
```{r}
dfNeighbor5<-
  df %>%
  filter(zipcode == 92110) %>%
  group_by(neighbourhood) %>%
  mutate(sum_high_neighbor = sum(high_booking_rate))

dfNeighbor_NumOfHomes5<-
  dfNeighbor5 %>%
  group_by(neighbourhood) %>%
  tally()

total_nei5 <- merge(dfNeighbor_NumOfHomes5, dfNeighbor5, by = "neighbourhood")

total_nei5<-
  total_nei5 %>%
  mutate(neigh_rate = sum_high_neighbor/n)

totalNeiNoDuplicate5 <- total_nei5[!duplicated(total_nei5$neighbourhood),]

total_nei_rank5<-
  totalNeiNoDuplicate5 %>%
  arrange(desc(neigh_rate))
total_nei_top10_5<-head(total_nei_rank5,10)
total_nei_top10_5
```
The neighbourhood that has highest proportion of having high booking rate in this area is Midtown.

### Features Finding: Calculate the proportion of having high booking rate for Airbnb homes with specific feature appeared.  
We checked almost all features but here we only keep features whcih may not be notied esily and maybe helpful for improving the probability to get high booking rate.
#### Original Proportion of high booking rate and non-high booking rate
```{r}
df %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Calculate the rate of getting high booking rate when the property type is cottage.
```{r}
df %>%
  filter(property_type=="Cottage") %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Calculate the rate of getting high booking rate when the room type is Entire home/apt.
```{r}
df %>%
  filter(room_type=="Entire home/apt") %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Calculate the rate of getting high booking rate when the number of bedrooms is one.
```{r}
df %>%
  filter(bedrooms==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Calculate the rate of getting high booking rate when bathroom/bedroom == 1.
```{r}
df %>%
  filter(availability_bathvsroom==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Calculate the rate of getting high booking rate when beds/bedroom == 2.
```{r}
df %>%
  filter(availability_bedvsroom==2) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Amenities to be checked: Dog friendly, Luggage dropped off, Self check-in, Barbecue, Microwave, Coffee.
```{r}
df %>%
  filter(amenities_dog==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

```{r}
df %>%
  filter(amenities_luggage==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

```{r}
df %>%
  filter(amenities_selfcheckin==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```


```{r}
df %>%
  filter(amenities_bbq==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```


```{r}
df %>%
  filter(amenities_microwave==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```


```{r}
df %>%
  filter(amenities_coffee==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```


#### Calculate the rate of getting high booking rate when the word (like sea) is contained in the desciption.
```{r}
df %>%
  filter(description_sea==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Keywords to be checked: restaurant, bars.
```{r}
df %>%
  filter(description_restaurant==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

```{r}
df %>%
  filter(description_bars==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```
#### Cancellation policy
```{r}
df %>%
  filter(cancellation_moderate==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Host response time
```{r}
df %>%
  filter(host_response_time=="within an hour") %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```
#### Host is super host
```{r}
df %>%
  filter(host_is_superhost==TRUE) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```

#### Host identify verified by Airbnb
```{r}
df %>%
  filter(host_identity_verified==TRUE) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```
#### Host verified by review
```{r}
df %>%
  filter(host_verifications_review==1) %>%
  group_by(high_booking_rate) %>%
  tally() %>%
  mutate(rate = 100*n/sum(n))
```


# **Result & Findings**
## Location Selection Results
After data visualization and analysis, we found that those zip codes with relatively higher booking rates can be grouped into two main areas: “Balboa Park Area” and “Ocean Beach Area”.  “Balboa Park Area” is an area centered on Balboa Park. ”Ocean Beach Area” is an area located on the upper bay of San Diego Bay.  

### Balboa Park Area (zip code: 92104, 92102, 92116, 92113, 92114, 92105)
The wonderful Balboa Park is definitely the best attraction in San Diego and it includes a lot of different places to have fun such as San Diego Art & Space Museum, San Diego Zoo, and Japanese friendship garden. The house at or near Balboa park will never worry about booking. It is just like the Mammoth Hot Springs Hotel & Cabins at YellowStone Park. People even need to book it one year in advance because it is rare that a hotel is located at the YellowStone.  
The Balboa Park neighborhood has the highest proportion (100%) of getting high booking rates in this area, but the number of Airbnb homes in that neighborhood is too small, so considering both the proportion of getting high booking rates and the number of homes in each neighborhood, we chose the North Park as the best neighborhood for investors in Balboa Park area.  

### Ocean Beach & UCSD Area (zip code: 92107, 92106, 92110, 92121)
Ocean Beach lies on the Pacific Ocean at the estuary of the San Diego River, at the western terminus of Interstate 8. Located about 7 miles (11 km) northwest of Downtown San Diego.  
It is a beautiful beach town and historic business district with attractions, restaurants, sunsets, shops, events,and fun.  
After analyzing the descriptions in the data set, we found that Airbnb, which has sea views, beaches, restaurants, bars, and downtown, has a higher booking rate for Airbnb, which is relatively higher. Compared to the Balboa park area and Ocean Beach & UCSD area, the second one will be more likely to have a sea view, bars, and beach. Additionally, UCSD is a potential area because the academic student population is increasing by 3% annually. Therefore, our final site selection will be the Ocean Beach & UCSD area.  
Since most of the customers of Airbnb are coming for vacation. We will take care about the tourist attractions, public securities, cost of living, and transportations when we analyze the location. To extract more information from the data, we need to analyze the neighborhood of each Airbnb in a specific area. We choose those neighborhoods whose neighborhood rate is above 0.5  from these two locations. The average neighborhood rate of San Diego is 0.29. Therefore, our choices are 70% above the average.  
Although some specific neighborhoods, midtown and university city, have a 100% high booking rate, we are going to choose some place with relatively higher supply.   Finally, we choose the ocean beach neighborhood which is a place located in the northwest of Ocean Beach & UCSD area. It is in a quiet residential area with sea views, bars, restaurants, and beach.  The residential areas are close to a lot of attractions and landmarks. It has convenient transportation, restaurants, and supermarkets. The real estate market is mature and has large supply. The professional housing management company is nearby. If investors want to purchase multiple houses, this is the best place to invest.

## Features Finding Results
This part we looked into property type, room type, amenities, description, host verification method, cancellation policy, super host, etc.  
We compare the original proportion of high booking rate with the original proportion of high booking rate with specific features  
The original proportion of high booking rate is only 28.8%  
But for Property type-Cottage, the proportion of cottage having a high booking rate increase up to 54%.  
For Room type-Entire apartment/house, the proportion increased to 31%.  
One bedroom airbnb homes has the proportion of high booking rate up to to 32%.  
1B1B homes have the proportion of high booking rate up to 30%.  
When the ratio between beds and bedrooms is 2, the proportion of high booking rate increase to 33%.  
Dog Friendly homes has the proportion of high booking rate up to 52%.  
Homes providing Luggage Drop-off Allowance have the proportion of high booking rate up to 46%.  
Homes providing Self Check-in Service have the proportion of high booking rate up to 45%.  
Homes providing coffee have the proportion of high booking rate up to 42%.  
Homes providing microwave have the proportion of high booking rate up to 41%.  
Homes providing barbecue place or tool have the proportion of high booking rate up to 37%.  
Homes including sea view in the description have the proportion of high booking rate up to 34%.  
Homes mentioning bar in the description have the proportion of high booking rate up to 33%.  
Homes mentioning restaurants in the description have the proportion of high booking rate up to 32%.  
Homes having moderate cancellation policy have the proportion of high booking rate up to 43%.  
Homes with host response time within 1 hour have the proportion of high booking rate up to 38%.  
Homes with a super host have the proportion of high booking rate up to 49%.  
Homes were verified by Airbnb or having review as verification way have the proportion of high booking rate up to 34%.

# **Conclusion and Discussion**

### Project Summary

San Diego, one of the most attractive cities in the United States, attracts lots of visitors around the world every year. The beaches, the sunshine, the sea wildlife and Latin American culture make every visitor who arrives in this city feel like living in a paradise. Therefore, Airbnb business in this city could be a very profitable and risky business. On the profitable side, millions of visitors came to this city to make San Diego become a very big rental market. On the risky side, thousands of business owners are running their rental business, so this is a very competitive market. In order to make more profits,  we conducted this research to find a good start point for running Airbnb business in this city.  

For location, we decided to choose North Park and Ocean Beach as our candidate locations to open our Airbnb home, because we found that these two locations are the most popular destinations for visitors who travel to San Diego based on our research. Therefore, we will seek our target house within these two areas. However, after we did features finding, the cottage stands out as the proporty type, so we will choose Ocean Beach, which is a better location for a cottage, to be our final decision.  

For our recommendation, we want to buy or build a cottage as our Airbnb home. In San Diego, cottage as a small house typically near lake or beach is very popular and are more likely to have a high booking rate based on our analysis results. In addition, our Airbnb house will have one bathroom and one bedroom with two beds, and the cottage will be rented in its entirety. The policy of cancellation of the booking better be moderate and hosts should try to respond with one hour.  

For the amenities, besides the necessary features like AC, Heating and so on,  we found that the features like Dog Friendliness, Luggage Drop-off Allowance, Self-check-in, Coffee, Microwave, Barbecue are very important. Sea View, Bars Access and Restaurants Access should be mentioned in the description of Airbnb home to attract more attentions from customers.  

Moreover, after we simulated our recommendation and test it with our model, we found that improvement is still needed. Based on our analysis results, there are some other espects we should pay attention to for increasing the probability of becoming a high_booking_rate home, which includes, host_is_super_host,host_identity_verified and features related to reviews. They may influence the high booking rate a lot. Even we did not include them when having our objective as initial aqusition of a Airbnb home, we will recommend hosts to work on them once their business starts in order to accomplish a high booking rate.  

### Limitation

From the dataset we had, we found several columns which were related to time. These columns were availability 30, availability 60, availability 90 and availability 365. Therefore, we noticed that many Airbnb business owners didn’t open their homes for the whole year. However, we did not have the specific time for the availability, whcih may indicate peak seasons and lack seasons within one year. The availability as well as the information about peak seasons and lack seasons would be important for high booking rate and very crucial for Airbnb business strategy, because they could be a guideline for hosts to decide their optimal schedule for setting prices and opening their home for rental. In theory, Opening home during peak season may be more likely to have a high booking rate. These strategies can increase revenues and reduce costs. Moreover, we didn’t have detailed cost data to help us to conduct our research, but cost is still a very important aspect for running a business. If we can’t obtain detailed cost data, our research would have a big drawback which could bring failure for our business.  

### Future research

Future research will be implemented by two aspects. The first aspect will be analysing the time series of prices of Airbnb rooms within our target locations. We want to know how the prices change during certain time periods to help us fully understand the complete picture of San Diego’s Airbnb Market. The time series of prices will also help us to find peak seasons and lack seasons, so we can easily decide our opening season of our Airbnb home. Another aspect will be obtaining cost data and analyzing cost data. Exact cost data can help us to have a more detailed pricing strategy and more well-organized house and feature development plan.  

# **Reference**
#### Airbnb: Summer Rentals in San Diego County Generated $122 Million: [link](https://timesofsandiego.com/business/2019/09/16/airbnb-summer-rentals-in-san-diego-county-generated-122-million/)
#### Airbnb® | San Diego Bay - Vacation Rentals & Places to Stay:[link](https://zh.airbnb.com/s/San-Diego-Bay--CA)
#### San Diego’s Airbnb Hotspots: [link](https://www.voiceofsandiego.org/business/san-diegos-airbnb-hotspots/)
#### What is Airbnb’s Superhost Status Really Worth?: [link](https://www.airdna.co/blog/airbnb_superhost_status)

# **Appendeix**
#### Dataset for San Deigo Market: [link](https://drive.google.com/file/d/1uZzJNwzCobZjtfpgBxp8ZlTLYXEuTNxT/view?usp=sharing)
#### Nice vedio about XGBoost for Classification: [link](https://www.youtube.com/watch?v=8b1JEDvenQU)